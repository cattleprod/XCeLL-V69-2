From d0c83b6dbb4795b63180c68c2c81f61e2d73f996 Mon Sep 17 00:00:00 2001
Message-Id: <d0c83b6dbb4795b63180c68c2c81f61e2d73f996.1315184977.git.hot2009wheels@hotmail.com>
In-Reply-To: <a4656eef4910f3ef802417e6bd17e3983b2fd5db.1315184977.git.hot2009wheels@hotmail.com>
References: <a4656eef4910f3ef802417e6bd17e3983b2fd5db.1315184977.git.hot2009wheels@hotmail.com>
From: LorD ClockaN <davor@losinj.com>
Date: Thu, 19 May 2011 15:36:44 +0200
Subject: [PATCH 07/14] UPDATE: fix warning [Jean Sacren]

---
 scripts/kconfig/conf.c |   15 +++++++++++++--
 scripts/kconfig/lkc.h  |    3 +++
 2 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/scripts/kconfig/conf.c b/scripts/kconfig/conf.c
index 9960d1c..47bfd30 100644
--- a/scripts/kconfig/conf.c
+++ b/scripts/kconfig/conf.c
@@ -102,7 +102,7 @@ static int conf_askvalue(struct symbol *sym, const char *def)
 		check_stdin();
 	case ask_all:
 		fflush(stdout);
-		fgets(line, 128, stdin);
+		xfgets(line, 128, stdin);
 		return 1;
 	default:
 		break;
@@ -304,7 +304,7 @@ static int conf_choice(struct menu *menu)
 			check_stdin();
 		case ask_all:
 			fflush(stdout);
-			fgets(line, 128, stdin);
+			xfgets(line, 128, stdin);
 			strip(line);
 			if (line[0] == '?') {
 				print_help(menu);
@@ -615,3 +615,14 @@ int main(int ac, char **av)
 	}
 	return 0;
 }
+/*
+* Helper function to facilitate fgets() by Jean Sacren.
+*/
+void xfgets(str, size, in)
+char *str;
+int size;
+FILE *in;
+{
+if (fgets(str, size, in) == NULL)
+fprintf(stderr, "\nError in reading or end of file.\n");
+}
diff --git a/scripts/kconfig/lkc.h b/scripts/kconfig/lkc.h
index ce6549c..eee7cec 100644
--- a/scripts/kconfig/lkc.h
+++ b/scripts/kconfig/lkc.h
@@ -72,6 +72,9 @@ void zconf_nextfile(const char *name);
 int zconf_lineno(void);
 char *zconf_curname(void);
 
+/* conf.c */
+void xfgets(char *str, int size, FILE *in);
+
 /* confdata.c */
 const char *conf_get_configname(void);
 const char *conf_get_autoconfig_name(void);
-- 
1.7.4.1

